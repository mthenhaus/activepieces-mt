"use strict";Object.defineProperty(exports, "__esModule", {value: true});

var _chunk5FSOOI2Gjs = require('./chunk-5FSOOI2G.js');


var _chunkWPXT6MG2js = require('./chunk-WPXT6MG2.js');


var _chunkUKHG6CH2js = require('./chunk-UKHG6CH2.js');

// src/receiving/mailer/author.ts
var MailerAuthorVerifier = class {
  constructor(senderVerifier) {
    this.senderVerifier = senderVerifier;
  }
  static create(configuration) {
    return new MailerAuthorVerifier(_chunk5FSOOI2Gjs.SenderVerifier.create(configuration));
  }
  /**
   * Checks if the author of the mailer is the same as the from address.
   * @param payload - The mailer payload
   * @returns
   */
  async verifyAuthorOwnsFromAddress(payload, rfcMail) {
    const mailerContent = _chunkWPXT6MG2js.parseMailerContentFromJSON.call(void 0, payload.Content.toString());
    const parsedContent = await _chunkUKHG6CH2js.parseMimeText.call(void 0, rfcMail);
    if (mailerContent.authorMailAddress.address !== parsedContent.mailData.from.address) {
      throw new Error("author address does not match from address");
    }
    return await this.senderVerifier.verifySenderOwnsFromAddress(
      parsedContent.mailData.from.address,
      mailerContent.authorMessagingKey
    );
  }
};



exports.MailerAuthorVerifier = MailerAuthorVerifier;
