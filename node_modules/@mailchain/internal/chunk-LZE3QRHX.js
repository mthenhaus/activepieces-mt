"use strict";Object.defineProperty(exports, "__esModule", {value: true});

var _chunkFFYIVDC6js = require('./chunk-FFYIVDC6.js');


var _chunkZIJL3L6Hjs = require('./chunk-ZIJL3L6H.js');

// src/transport/deliveryRequests/envelope.ts





var _crypto = require('@mailchain/crypto');
async function createEnvelope(recipientMessagingKey, messageRootEncryptionKey, messageURI, rand = _crypto.secureRandom) {
  const keyBundle = await _chunkFFYIVDC6js.createECDHKeyBundle.call(void 0, recipientMessagingKey, rand);
  const encrypter = _crypto.PrivateKeyEncrypter.fromPrivateKey(_crypto.ED25519PrivateKey.fromSeed(keyBundle.secret), rand);
  const encryptedMessageKey = await encrypter.encrypt(
    _crypto.privateKeyToBytes.call(void 0, messageRootEncryptionKey.privateKey)
  );
  const encryptedMessageURI = await encrypter.encrypt(Buffer.from(messageURI, "utf8"));
  const payload = {
    encryptedMessageKey,
    encryptedMessageUri: encryptedMessageURI,
    ecdhKeyBundle: keyBundle.keyBundle
  };
  const errMsg = _chunkZIJL3L6Hjs.protocol.Envelope.verify(payload);
  if (errMsg)
    throw Error(errMsg);
  return _chunkZIJL3L6Hjs.protocol.Envelope.create(payload);
}



exports.createEnvelope = createEnvelope;
