"use strict";Object.defineProperty(exports, "__esModule", {value: true});

var _chunkZIJL3L6Hjs = require('./chunk-ZIJL3L6H.js');

// src/transport/deliveryRequests/keybundle.ts
var _crypto = require('@mailchain/crypto');
async function createECDHKeyBundle(recipientMessagingKey, rand = _crypto.secureRandom) {
  const keyEx = new (0, _crypto.ED25519KeyExchange)(rand);
  const ephemeralKey = await keyEx.EphemeralKey();
  const sharedSecret = await keyEx.SharedSecret(ephemeralKey, recipientMessagingKey);
  const payload = {
    publicMessagingKey: _crypto.publicKeyToBytes.call(void 0, recipientMessagingKey),
    publicEphemeralKey: _crypto.publicKeyToBytes.call(void 0, ephemeralKey.publicKey)
  };
  const errMsg = _chunkZIJL3L6Hjs.protocol.ECDHKeyBundle.verify(payload);
  if (errMsg) {
    throw Error(errMsg);
  }
  return {
    secret: sharedSecret,
    keyBundle: _chunkZIJL3L6Hjs.protocol.ECDHKeyBundle.create(payload)
  };
}



exports.createECDHKeyBundle = createECDHKeyBundle;
