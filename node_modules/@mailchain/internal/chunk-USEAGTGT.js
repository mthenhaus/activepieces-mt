"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }// src/mailbox/addressIdentityKeyResolver.ts




var _addressing = require('@mailchain/addressing');
var _isEqualjs = require('lodash/isEqual.js'); var _isEqualjs2 = _interopRequireDefault(_isEqualjs);
function createMailchainApiAddressIdentityKeyResolver(identityKeys) {
  return (address) => identityKeys.getAddressIdentityKey(address);
}
function createMessageHeaderIdentityKeyResolver(addressIdentityKeys) {
  return async (address) => {
    const entry = addressIdentityKeys.get(_addressing.formatAddress.call(void 0, address, "mail"));
    if (entry == null)
      return null;
    try {
      const actualAddressBytes = _addressing.decodeAddressByProtocol.call(void 0, address.username, entry.protocol).decoded;
      const expectedAddressBytes = await _addressing.addressFromPublicKey.call(void 0, entry.identityKey, entry.protocol);
      if (_isEqualjs2.default.call(void 0, expectedAddressBytes, actualAddressBytes))
        return entry;
    } catch (e) {
    }
    return null;
  };
}




exports.createMailchainApiAddressIdentityKeyResolver = createMailchainApiAddressIdentityKeyResolver; exports.createMessageHeaderIdentityKeyResolver = createMessageHeaderIdentityKeyResolver;
