"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }// src/hd.ts
var _blake2b = require('@noble/hashes/blake2b');
var _encoding = require('@mailchain/encoding');
var _bnjs = require('bn.js'); var _bnjs2 = _interopRequireDefault(_bnjs);
var CHAIN_CODE_LEN = 32;
function chainCodeFromDeriveIndex(value) {
  if (isNumber(value) || _bnjs2.default.isBN(value)) {
    return chainCodeFromDeriveIndex(Uint8Array.from(new (0, _bnjs2.default)(value).toArray("le", 256 / 8)));
  } else if (isString(value) && _encoding.isHexZeroX.call(void 0, value)) {
    return chainCodeFromDeriveIndex(_encoding.decodeHexZeroX.call(void 0, value));
  } else if (isString(value)) {
    return chainCodeFromDeriveIndex(Uint8Array.from([...compactToU8a(value.length), ..._encoding.decodeUtf8.call(void 0, value)]));
  } else if (value.length > CHAIN_CODE_LEN) {
    return chainCodeFromDeriveIndex(_blake2b.blake2b.call(void 0, value, { dkLen: 256 / 8 }));
  }
  const chainCode = new Uint8Array(32);
  chainCode.fill(0);
  chainCode.set(value, 0);
  return chainCode;
}
function isNumber(value) {
  return typeof value === "number";
}
function isString(value) {
  return typeof value === "string" || value instanceof String;
}
var BN_ONE = new (0, _bnjs2.default)(1);
var BN_TWO = new (0, _bnjs2.default)(2);
var MAX_U8 = BN_TWO.pow(new (0, _bnjs2.default)(8 - 2)).isub(BN_ONE);
var MAX_U16 = BN_TWO.pow(new (0, _bnjs2.default)(16 - 2)).isub(BN_ONE);
function compactToU8a(value) {
  const bn = new (0, _bnjs2.default)(value);
  if (bn.lte(MAX_U8)) {
    return new Uint8Array([bn.toNumber() << 2]);
  } else if (bn.lte(MAX_U16)) {
    return bn.shln(2).iadd(BN_ONE).toArray("le", 16 / 8);
  }
  return bn.shln(2).iadd(BN_TWO).toArray("le", 32 / 8);
}



exports.chainCodeFromDeriveIndex = chainCodeFromDeriveIndex;
